## 2022/6/8——字节面经汇总



#### 1. TCP协议保证可靠传输

1. 数据块被分成合适发送的数据块， TCP对每一个发送的包进行编号，排序，然后传送给应用层。
2. ==校验和==：checksum, TCP保持它首部和数据的校验和。
3. ==流量控制== ：TCP连接的每一方都有一个固定大小的缓存空间。
4. ==拥塞控制==：网络拥塞时，减少数据的发送
5. ==ARQ协议==: 实现可靠传输， 发送完一个分组就停止发送，等待对方确认。确认后，再发送下一个分组。
6. ==超时重传==：当TCP发出一个段后， 启动定时器，等待接收端的回复。



#### 2. C++ 多态的实现原理

> 实现原理：
>
> - 类中存在虚函数时，编译器会在类中生成一个虚函数表
> - 虚函数表**==存储类成员函数指针==**的 数据结构
> - 虚函数表由  ==编译器自动生成和维护== 
> - virtual修饰的成员函数会被 编译器放入虚函数表中
> - 存在虚函数时， 编译器会为对象生成 一个指向 虚函数表的指针（==vptr指针==）

​	vptr的分布初始化：

​		在父类中调用虚函数时， 执行的是父类的函数， 没有发生多态。

1. 对象创建时， 编译器对vptr 进行初始化
2. 子类的构造会先调用父类的 构造函数， 此时 vptr指向父类的 虚函数表
3. 子类构造时，vptr会再执行子类的 虚函数表
4. 对象创建完后， vptr最终指向确定

#### 3. 集成、多态、重写和重载的区别

1）继承是子类获得父类的成员，

2）重写是继承后重新实现父类的方法。

3）重载是在一个		类里一系列		参数不同		名字相同的方法。

4）多态则是为了避免在父类里大量重载引起代码臃肿且难于维护。

#### 4. Linux的4种锁机制

1. 互斥锁——mutex：保证任何时候只有一个线程访问该对象。
2. 读写锁——rwlock
   1. 读锁：读操作时候，允许多个线程同时获得读操作。
   2. 写锁：但同时刻，只有一个线程获得写锁。 当写锁被获得时， 读锁不能被获取。
   3. 写锁能抢占读锁
3. 自旋锁——spinlock：任何时刻只有一个线程访问对象。但是当获取 ==锁操作==失败时，不会进入睡眠状态，而是保持原地自旋，知道锁被释放。 ==节省了线程被唤醒的时间==， 加锁时间短，效率高；但是加锁时间长，会浪费CPU资源。
4. RCU——read-copy-update: 修改数据时，读取数据，生成一个副本，对副本进行修改。之后进行update操作。 ==优点==：读取不需要获取锁，不需要考虑死锁问题。 但是写的同步开销大。==使用场景==：大量读操作，少量写操作情况。

#### 5. 改进死循环

1. 线程池、生产者消费者模式

2. 使用select , epoll技术

   1. select技术：$O(n)$时间复杂度，==知道IO发生，但是不知道有多少，是哪个==， 所以只有无差别轮训，找出数据流。
   2. poll技术：$O(n)$时间复杂度，==将用户传入的数据拷贝到内存空间，然后查询每个fd对应的设备状态==      区别：没有最大连接数的限制，基于链表存储
   3. epoll技术：$O(1)$时间复杂度：event poll，通知哪个流 发生了 怎样的I/O事件。实际上为 ==事件驱动== 

   以上3者，都是IO多路复用的机制。==什么是IO多路复用？==： 通过一种机制，监视多个描述符，一旦某个描述符就绪，通知程序进行相应的 读写操作。

   特点：select, poll, epoll都是==同步==IO， 需要在读写事件就绪后 自己负责进行读写， 读写过程是阻塞的；==异步IO==无需自己进行读写， 把数据从内核拷贝到用户空间。

#### 6. 什么是==同步I/O==和==异步I/O==

​		区别：对文件的读写是否经过 内核态和用户态的切换

​	**同步I/O：**

> 同步IO指的是用户进程触发I/O操作并等待或者轮询的去查看I/O操作是否就绪。
> ==同步IO的执行者是IO操作的发起者。==
> ==同步IO==需要发起者进行==内核态到用户态的数据拷贝==过程，所以这里必须阻塞

​	**异步I/O：**

> 异步IO是指用户进程触发I/O操作以后就立即返回，继续开始做自己的事情，而当I/O操作已经完成的时候会得到I/O完成的通知。
> ==异步IO的执行者是内核线程==，内核线程将数据从内核态拷贝到用户态，所以这里没有阻塞

#### 7. linux是如何使用水平和边缘触发的呢？

- 水平触发：文件描述符 已经就绪，可以执行非阻塞的IO操作，和触发通知。

  允许在任意时刻重复检测 IO 的状态。 ==select, poll就是水平触发==

- 边缘触发：文件描述符改变状态，就会触发。信号IO 是边缘触发。

- epoll既可以采用水平触发，也可以使用边缘触发。